{"remainingRequest":"/Users/haojianie/Desktop/Web/rppg-master/node_modules/babel-loader/lib/index.js!/Users/haojianie/Desktop/Web/rppg-master/node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js??ref--13-0!/Users/haojianie/Desktop/Web/rppg-master/src/components/sketch.js","dependencies":[{"path":"/Users/haojianie/Desktop/Web/rppg-master/src/components/sketch.js","mtime":1597617582741},{"path":"/Users/haojianie/Desktop/Web/rppg-master/node_modules/cache-loader/dist/cjs.js","mtime":1597616075057},{"path":"/Users/haojianie/Desktop/Web/rppg-master/node_modules/babel-loader/lib/index.js","mtime":1597616074968},{"path":"/Users/haojianie/Desktop/Web/rppg-master/node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js","mtime":1597616074257}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiL1VzZXJzL2hhb2ppYW5pZS9EZXNrdG9wL1dlYi9ycHBnLW1hc3Rlci9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCAqIGFzIHZpcyBmcm9tICd2aXMtdGltZWxpbmUvc3RhbmRhbG9uZSc7CmltcG9ydCAqIGFzIHRmIGZyb20gJ0B0ZW5zb3JmbG93L3RmanMnOwppbXBvcnQgeyBBdHRlbnRpb25NYXNrIH0gZnJvbSAnLi9BdHRlbnRpb25NYXNrLmpzJzsKaW1wb3J0IHsgVFNNIH0gZnJvbSAnLi9UU00uanMnOwpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBydW4oKSB7CiAgdmFyIHZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZGVvJyk7CiAgdmFyIHBhdGggPSAiLi9tb2RlbC5qc29uIjsKICB2YXIgb3JpZ192LCBYc3ViLCBkWHN1YiwgcHJldkZyYW1lOwogIHZhciBkaWZmQmF0Y2gsIEJhdGNoOwogIHZhciBkZWxheSA9IDMwOwogIHZhciBiYXRjaF9zaXplID0gMjA7CiAgdmFyIGJhdGNoX2NvdW50ZXIgPSAwOwogIHZhciBkaW0gPSAzNjsKICB2YXIgcHJlZGljdGlvbjsKICB2YXIgbW9kZWw7CiAgdGYuc2VyaWFsaXphdGlvbi5yZWdpc3RlckNsYXNzKFRTTSk7CiAgdGYuc2VyaWFsaXphdGlvbi5yZWdpc3RlckNsYXNzKEF0dGVudGlvbk1hc2spOwogIGxvYWRNb2RlbCgpOwoKICBmdW5jdGlvbiBsb2FkTW9kZWwoKSB7CiAgICByZXR1cm4gX2xvYWRNb2RlbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0KCiAgZnVuY3Rpb24gX2xvYWRNb2RlbCgpIHsKICAgIF9sb2FkTW9kZWwgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gdGYubG9hZExheWVyc01vZGVsKHBhdGgpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIG1vZGVsID0gX2NvbnRleHQyLnNlbnQ7CgogICAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi8KICAgICAgICAgICAgICBjb25zb2xlLmxvZygiU3VjY2Vzc2Z1bGx5IGxvYWRlZCBtbCBtb2RlbCIpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTIpOwogICAgfSkpOwogICAgcmV0dXJuIF9sb2FkTW9kZWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NNb2RlbCgpIHsKICAgIHJldHVybiBfcHJvY2Vzc01vZGVsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQoKICBmdW5jdGlvbiBfcHJvY2Vzc01vZGVsKCkgewogICAgX3Byb2Nlc3NNb2RlbCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgIHZhciByZXN1bHQ7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiB0Zi5sb2FkTGF5ZXJzTW9kZWwocGF0aCk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgbW9kZWwgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICByZXN1bHQgPSBtb2RlbC5wcmVkaWN0KGRpZmZCYXRjaCwgQmF0Y2gpOwogICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7CiAgICAgICAgICAgICAgcmVzdWx0LnByaW50KDEpOwogICAgICAgICAgICAgIHByZWRpY3Rpb24gPSByZXN1bHQ7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMyk7CiAgICB9KSk7CiAgICByZXR1cm4gX3Byb2Nlc3NNb2RlbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0KCiAgdmFyIG5hbWVzID0gWyJ1bmlmb3JtIl07CiAgdmFyIGdyb3VwcyA9IG5ldyB2aXMuRGF0YVNldCgpOwogIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlzdWFsaXphdGlvbiIpOwogIHZhciBkYXRhc2V0ID0gbmV3IHZpcy5EYXRhU2V0KCk7CiAgdmFyIG5vdyA9IHZpcy5tb21lbnQoKTsKICB2YXIgb3B0aW9ucyA9IHsKICAgIGRyYXdQb2ludHM6IGZhbHNlLAogICAgZGF0YUF4aXM6IHsKICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgbGVmdDogewogICAgICAgIHRpdGxlOiB7CiAgICAgICAgICB0ZXh0OiAiTm9ybWFsaXplZCBBbXBsaXR1ZGUiCiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgbGVnZW5kOiBmYWxzZSwKICAgIHN0YXJ0OiB2aXMubW9tZW50KCkuYWRkKC01LCAic2Vjb25kcyIpLAogICAgLy8gZGlzcGxheSBzdGFydCwgIGVuZAogICAgZW5kOiB2aXMubW9tZW50KCkuYWRkKDEwLCAic2Vjb25kcyIpCiAgfTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCgogIHZhciBncmFwaDJkID0gbmV3IHZpcy5HcmFwaDJkKGNvbnRhaW5lciwgZGF0YXNldCwgZ3JvdXBzLCBvcHRpb25zKTsgLy8gY291bGQgZGVsZXRlIHRoZSBncm91cCAsIGp1c3QgdXNlIGRhdGFzZXQKCiAgZ3JvdXBzLmFkZCh7CiAgICBpZDogMCwKICAgIGNvbnRlbnQ6IG5hbWVzWzBdLAogICAgb3B0aW9uczogewogICAgICBkcmF3UG9pbnRzOiBmYWxzZSwKICAgICAgaW50ZXJwb2xhdGlvbjogewogICAgICAgIHBhcmFtZXRyaXphdGlvbjogInVuaWZvcm0iCiAgICAgIH0KICAgIH0KICB9KTsKICBzdGFydFZpZGVvKCk7IC8vaW5pdGlhbGl6ZV9jaGFydCgpOwoKICB2YXIgbG9vcF9jb3VudGVyID0gMDsKCiAgZnVuY3Rpb24gbG9vcCgpIHsKICAgIGlmIChsb29wX2NvdW50ZXIgPCAyMikgewogICAgICBsb29wX2NvdW50ZXIrKzsKICAgICAgcHJlcHJvY2VzcygpOwogICAgICBzZXRUaW1lb3V0KGxvb3AsIGRlbGF5KTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHByZXByb2Nlc3MoKSB7CiAgICBvcmlnX3YgPSB0Zi5icm93c2VyLmZyb21QaXhlbHModmlkZW8pOwogICAgWHN1YiA9IHRmLmltYWdlLnJlc2l6ZUJpbGluZWFyKG9yaWdfdiwgW2RpbSwgZGltXSk7CiAgICBYc3ViID0gWHN1Yi5hc1R5cGUoJ2Zsb2F0MzInKS5kaXYodGYuc2NhbGFyKDI1NSkpOwogICAgWHN1YiA9IFhzdWIuZXhwYW5kRGltcygwKTsgLy8gKDEsIDM2LCAzNiwgMykKCiAgICBpZiAocHJldkZyYW1lID09IG51bGwpIHsKICAgICAgcHJldkZyYW1lID0gWHN1YjsKICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tY29uc29sZSAqLwoKICAgICAgY29uc29sZS5sb2coImluaXRpYWxpemUiKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgLy8gZGlkbid0IGdldCAgb25seSB0aGUgMzAwLCAzMDAgLCBpZSBkaWRuJ3QgY3JvcAkJCiAgICAgIC8vIEZSQU1FIERJRkY6CiAgICAgIGRYc3ViID0gdGYuZGl2KHRmLnN1YihYc3ViLCBwcmV2RnJhbWUpLCB0Zi5hZGQoWHN1YiwgcHJldkZyYW1lKSk7IC8vIFNVQlRSQUNUIE1FQU4gT0YgSU1HOgoKICAgICAgZFhzdWIgPSB0Zi5kaXYoZFhzdWIsIHRmLm1vbWVudHMoZFhzdWIpLnZhcmlhbmNlLnNxcnQoKSk7IC8vICgxLCAzNiwgMzYsIDMpCgogICAgICBYc3ViID0gdGYuc3ViKFhzdWIsIHRmLm1lYW4oWHN1YikpOwogICAgICBYc3ViID0gdGYuZGl2KFhzdWIsIHRmLm1vbWVudHMoWHN1YikudmFyaWFuY2Uuc3FydCgpKTsgLy8gKDEsIDM2LCAzNiwgMykKCiAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi8KCiAgICAgIGNvbnNvbGUubG9nKCJiZWxvdyBpcyBYIGJlZm9yZSBtZWFuIik7CiAgICAgIHByZXZGcmFtZSA9IFhzdWI7CgogICAgICBpZiAoYmF0Y2hfY291bnRlciA9PSAwKSB7CiAgICAgICAgQmF0Y2ggPSB0Zi5jYXN0KFhzdWIsICdmbG9hdDMyJyk7CiAgICAgICAgZGlmZkJhdGNoID0gZFhzdWI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgQmF0Y2gucHJpbnQodHJ1ZSk7CiAgICAgICAgZGlmZkJhdGNoLnByaW50KHRydWUpOwogICAgICAgIEJhdGNoID0gdGYuY29uY2F0KFtCYXRjaCwgWHN1Yl0pOyAvLyBub3RlIHRoZSB4c3ViIGhlcmUgaXMgYWZ0ZXIgCgogICAgICAgIGRpZmZCYXRjaCA9IHRmLmNvbmNhdChbZGlmZkJhdGNoLCBkWHN1Yl0pOwogICAgICB9CgogICAgICBiYXRjaF9jb3VudGVyKys7CiAgICB9CgogICAgaWYgKGJhdGNoX2NvdW50ZXIgPT0gYmF0Y2hfc2l6ZSkgewogICAgICAvLyBjYWxsIHVwZGF0ZSB0aGUgY2hhcnQKICAgICAgQmF0Y2ggPSB0Zi50cmFuc3Bvc2UoQmF0Y2gsIFsyLCAxLCAzLCAwXSk7IC8vIHN3YXAgYXhpcwoKICAgICAgQmF0Y2ggPSB0Zi5leHBhbmREaW1zKEJhdGNoLCAwKTsgLy8gZXhwYW5kIGRpbWVuc2lvbgoKICAgICAgZGlmZkJhdGNoID0gdGYudHJhbnNwb3NlKGRpZmZCYXRjaCwgWzIsIDEsIDMsIDBdKTsgLy8gc3dhcCBheGlzCgogICAgICBkaWZmQmF0Y2ggPSB0Zi5leHBhbmREaW1zKGRpZmZCYXRjaCwgMCk7IC8vIGV4cGFuZCBkaW1lbnNpb24KCiAgICAgIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiBwcm9jZXNzTW9kZWwoKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgIH0pKSgpOwoKICAgICAgYWRkRGF0YVBvaW50KCk7IC8vIGluaXRpYWxpemF0aW9uIGZvciB0aGUgbmV4dCBpdGVyYXRpb24KCiAgICAgIEJhdGNoID0gbnVsbDsKICAgICAgZGlmZkJhdGNoID0gbnVsbDsKICAgICAgcHJldkZyYW1lID0gbnVsbDsKICAgICAgYmF0Y2hfY291bnRlciA9IDA7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzdGFydFZpZGVvKCkgewogICAgaWYgKG5hdmlnYXRvci5tZWRpYURldmljZXMgJiYgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpIHsKICAgICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoewogICAgICAgIHZpZGVvOiB0cnVlCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgIHZpZGVvLnNyY09iamVjdCA9IHN0cmVhbTsKICAgICAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKCJsb2FkZWRtZXRhZGF0YSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIHVzZWQgdG8gaGF2ZSBhbiBlIGhlcmUKICAgICAgICAgIHZpZGVvLnBsYXkoKTsKICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi8KCiAgICAgICAgICBjb25zb2xlLmxvZygiV2ViY2FtIHZpZGVvIHN1Y2Nlc3NmdWxseSBsb2FkZWQiKTsKICAgICAgICAgIGxvb3AoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSAvLyB0aGUgY2hhcnQKCgogIGZ1bmN0aW9uIGFkZERhdGFQb2ludCgpIHsKICAgIHZhciBub3cgPSB2aXMubW9tZW50KCk7CiAgICBjb25zb2xlLmxvZygiaW5zaWRlIHByZWRpY3Rpb24iKTsKICAgIGNvbnNvbGUubG9nKHByZWRpY3Rpb24pOwogICAgZGF0YXNldC5hZGQoW3sKICAgICAgeDogbm93LAogICAgICB5OiBwcmVkaWN0aW9uLAogICAgICBncm91cDogMAogICAgfV0pOwogICAgc2V0VGltZW91dChtb3ZlV2luZG93LCBkZWxheSk7CiAgfQoKICBmdW5jdGlvbiBtb3ZlV2luZG93KCkgewogICAgdmFyIHN0cmF0ZWd5ID0gJ3N0YXRpYyc7CiAgICB2YXIgcmFuZ2UgPSBncmFwaDJkLmdldFdpbmRvdygpOwogICAgbm93ID0gdmlzLm1vbWVudCgpOwogICAgdmFyIGludGVydmFsID0gcmFuZ2UuZW5kIC0gcmFuZ2Uuc3RhcnQ7CgogICAgaWYgKG5vdyA+IHJhbmdlLmVuZCkgewogICAgICBncmFwaDJkLnNldFdpbmRvdyhub3cgLSAwLjEgKiBpbnRlcnZhbCwgbm93ICsgMC45ICogaW50ZXJ2YWwpOwogICAgfQoKICAgIHN3aXRjaCAoc3RyYXRlZ3kpIHsKICAgICAgZGVmYXVsdDoKICAgICAgICAvLyAnc3RhdGljJwogICAgICAgIC8vIG1vdmUgdGhlIHdpbmRvdyA5MCUgdG8gdGhlIGxlZnQgd2hlbiBub3cgaXMgbGFyZ2VyIHRoYW4gdGhlIGVuZCBvZiB0aGUgd2luZG93CiAgICAgICAgaWYgKHJhbmdlID4gMTApIHsKICAgICAgICAgIC8vCQljb25zb2xlLmxvZygibW92ZSB3aW5kb3ciKTsKICAgICAgICAgIGdyYXBoMmQuc2V0V2luZG93KG5vdyAtIDAuMSAqIGludGVydmFsLCBub3cgKyAwLjkgKiBpbnRlcnZhbCk7CiAgICAgICAgfQoKICAgICAgICBzZXRUaW1lb3V0KG1vdmVXaW5kb3csIGRlbGF5KTsKICAgICAgICBicmVhazsKICAgIH0KICB9Cn0="},{"version":3,"sources":["/Users/haojianie/Desktop/Web/rppg-master/src/components/sketch.js"],"names":["vis","tf","AttentionMask","TSM","run","video","document","getElementById","path","orig_v","Xsub","dXsub","prevFrame","diffBatch","Batch","delay","batch_size","batch_counter","dim","prediction","model","serialization","registerClass","loadModel","loadLayersModel","console","log","processModel","result","predict","print","names","groups","DataSet","container","dataset","now","moment","options","drawPoints","dataAxis","visible","left","title","text","legend","start","add","end","graph2d","Graph2d","id","content","interpolation","parametrization","startVideo","loop_counter","loop","preprocess","setTimeout","browser","fromPixels","image","resizeBilinear","asType","div","scalar","expandDims","sub","moments","variance","sqrt","mean","cast","concat","transpose","addDataPoint","navigator","mediaDevices","getUserMedia","then","stream","srcObject","addEventListener","play","x","y","group","moveWindow","strategy","range","getWindow","interval","setWindow"],"mappings":"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","sourcesContent":["import * as vis from 'vis-timeline/standalone';\r\nimport * as tf from '@tensorflow/tfjs';\nimport {\r\n\tAttentionMask\r\n} from './AttentionMask.js';\r\nimport {\r\n\tTSM\r\n} from './TSM.js';\r\n\r\nexport default function run() {\r\n\r\n\tlet video = document.getElementById('video');\n\tvar path = \"./model.json\";\r\n\tvar orig_v, Xsub, dXsub, prevFrame;\r\n\tvar diffBatch, Batch;\r\n\tvar delay = 30;\r\n\tvar batch_size = 20;\r\n\tvar batch_counter = 0;\r\n\tvar dim = 36;\r\n\tvar prediction;\r\n\tlet model;\r\n\n\ttf.serialization.registerClass(TSM);\n\ttf.serialization.registerClass(AttentionMask);\n\n\tloadModel();\n\tasync function loadModel() {\n\t\tmodel = await tf.loadLayersModel(path);\n\t\t/* eslint-disable no-console */\n\t\tconsole.log(\"Successfully loaded ml model\");\n\t}\n\t\r\n\tasync function processModel() {\n\t\tmodel = await tf.loadLayersModel(path);\r\n\t\tvar result = model.predict(diffBatch, Batch);\n\t\tconsole.log(result);\n\t\tresult.print(1);\r\n\t\tprediction = result;\r\n\t}\r\n\r\n\tvar names = [\"uniform\"];\r\n\tvar groups = new vis.DataSet();\r\n\tvar container = document.getElementById(\"visualization\");\r\n\tvar dataset = new vis.DataSet();\r\n\tvar now = vis.moment();\r\n\r\n\tvar options = {\r\n\t\tdrawPoints: false,\r\n\t\tdataAxis: {\r\n\t\t\tvisible: true,\r\n\t\t\tleft: {\r\n\t\t\t\ttitle: {\r\n\t\t\t\t\ttext: \"Normalized Amplitude\",\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tlegend: false,\r\n\t\tstart: vis.moment().add(-5, \"seconds\"), // display start,  end\r\n\t\tend: vis.moment().add(10, \"seconds\"),\r\n\r\n\t};\r\n\r\n\t// eslint-disable-next-line\r\n\tvar graph2d = new vis.Graph2d(container, dataset, groups, options);\r\n\r\n\t// could delete the group , just use dataset\r\n\tgroups.add({\r\n\t\tid: 0,\r\n\t\tcontent: names[0],\r\n\t\toptions: {\r\n\t\t\tdrawPoints: false,\r\n\t\t\tinterpolation: {\r\n\t\t\t\tparametrization: \"uniform\",\r\n\t\t\t},\r\n\t\t},\r\n\t});\r\n\r\n\r\n\tstartVideo();\r\n\t//initialize_chart();\r\n\tvar loop_counter = 0;\r\n\tfunction loop() {\n\t\t\n\t\tif (loop_counter <  22){\n\t\t\tloop_counter ++;\n\t\t\r\n\t\tpreprocess();\n\t\t\n\t\t\r\n\t\t\n\t\tsetTimeout(loop, delay);\n\t\t}\r\n\t}\r\n\r\n\tfunction preprocess() {\r\n\t\torig_v = tf.browser.fromPixels(video);\r\n\r\n\t\tXsub = tf.image.resizeBilinear(orig_v, [dim, dim]);\r\n\r\n\t\tXsub = Xsub.asType('float32').div(tf.scalar(255));\r\n\t\tXsub = Xsub.expandDims(0); // (1, 36, 36, 3)\r\n\r\n\r\n\r\n\t\tif (prevFrame == null) {\r\n\t\t\tprevFrame = Xsub;\r\n\t\t\t/* eslint-disable no-console */\r\n\t\t\tconsole.log(\"initialize\")\n\t\t\t\r\n\t\t} else {\r\n\t\t\t//--------------------------------------\r\n\t\t\t// didn't get  only the 300, 300 , ie didn't crop\t\t\r\n\r\n\t\t\t// FRAME DIFF:\r\n\t\t\tdXsub = tf.div(tf.sub(Xsub, prevFrame), tf.add(Xsub, prevFrame));\r\n\r\n\t\t\t// SUBTRACT MEAN OF IMG:\r\n\t\t\tdXsub = tf.div(dXsub, tf.moments(dXsub).variance.sqrt()); // (1, 36, 36, 3)\r\n\t\t\tXsub = tf.sub(Xsub, tf.mean(Xsub));\r\n\t\t\tXsub = tf.div(Xsub, tf.moments(Xsub).variance.sqrt()); // (1, 36, 36, 3)\r\n\t\t\t/* eslint-disable no-console */\r\n\t\t\tconsole.log(\"below is X before mean\")\r\n\r\n\t\t\tprevFrame = Xsub;\r\n\t\t\tif (batch_counter == 0) {\r\n\t\t\t\tBatch = tf.cast(Xsub, 'float32');\r\n\t\t\t\tdiffBatch = dXsub;\r\n\t\t\t} else {\r\n\t\t\t\tBatch.print(true);\r\n\t\t\t\tdiffBatch.print(true);\n\t\t\t\t\r\n\t\t\t\tBatch = tf.concat([Batch, Xsub]) // note the xsub here is after \r\n\t\t\t\tdiffBatch = tf.concat([diffBatch, dXsub]);\r\n\r\n\t\t\t}\r\n\t\t\tbatch_counter++;\r\n\t\t}\r\n\r\n\t\tif (batch_counter == batch_size) {\r\n\r\n\t\t\t// call update the chart\r\n\t\t\tBatch = tf.transpose(Batch, [2, 1, 3, 0]); // swap axis\r\n\t\t\tBatch = tf.expandDims(Batch, 0); // expand dimension\r\n\r\n\t\t\tdiffBatch = tf.transpose(diffBatch, [2, 1, 3, 0]); // swap axis\r\n\t\t\tdiffBatch = tf.expandDims(diffBatch, 0); // expand dimension\r\n\r\n\t\t\t(async () => {\n\t\t\t\tawait processModel();\n\t\t\t})()\r\n\t\t\taddDataPoint();\r\n\t\t\t// initialization for the next iteration\r\n\t\t\tBatch = null;\r\n\t\t\tdiffBatch = null;\r\n\t\t\tprevFrame = null;\r\n\t\t\tbatch_counter = 0;\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tfunction startVideo() {\r\n\t\tif (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n\t\t\tnavigator.mediaDevices.getUserMedia({\r\n\t\t\t\tvideo: true\r\n\t\t\t}).then(function(stream) {\r\n\t\t\t\tvideo.srcObject = stream;\r\n\t\t\t\tvideo.addEventListener(\"loadedmetadata\", function() { // used to have an e here\r\n\t\t\t\t\tvideo.play();\r\n\t\t\t\t\t/* eslint-disable no-console */\r\n\t\t\t\t\tconsole.log(\"Webcam video successfully loaded\");\r\n\t\t\t\t\tloop();\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t// the chart\r\n\tfunction addDataPoint() {\r\n\t\tvar now = vis.moment();\n\t\t\n\t\tconsole.log(\"inside prediction\");\n\t\tconsole.log(prediction);\r\n\t\tdataset.add([{\r\n\t\t\tx: now,\r\n\t\t\ty: prediction,\r\n\t\t\tgroup: 0\r\n\t\t}])\r\n\r\n\t\tsetTimeout(moveWindow, delay);\r\n\t}\r\n\r\n\tfunction moveWindow() {\r\n\r\n\t\tlet strategy = 'static';\r\n\t\tvar range = graph2d.getWindow();\r\n\t\tnow = vis.moment();\r\n\r\n\t\tvar interval = range.end - range.start;\r\n\r\n\t\tif (now > range.end) {\r\n\t\t\tgraph2d.setWindow(now - 0.1 * interval, now + 0.9 * interval);\r\n\t\t}\r\n\r\n\t\tswitch (strategy) {\r\n\t\t\tdefault: // 'static'\r\n\t\t\t\t// move the window 90% to the left when now is larger than the end of the window\r\n\t\t\t\tif (range > 10) {\r\n\t\t\t\t\t//\t\tconsole.log(\"move window\");\r\n\t\t\t\t\tgraph2d.setWindow(now - 0.1 * interval, now + 0.9 * interval);\r\n\t\t\t\t}\r\n\t\t\t\tsetTimeout(moveWindow, delay);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n"]}]}